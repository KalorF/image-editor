# Canvas å›¾åƒç¼–è¾‘å™¨æ¡†æ¶

ä¸€ä¸ªåŸºäºåŸç”ŸCanvaså®ç°çš„æ¨¡å—åŒ–å›¾åƒç¼–è¾‘å™¨æ¡†æ¶

## ğŸš€ ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç”»å¸ƒç¼©æ”¾å’Œç§»åŠ¨** - æ”¯æŒé¼ æ ‡æ»šè½®ç¼©æ”¾ã€æ‹–æ‹½å¹³ç§»ã€ç©ºæ ¼é”®å¹³ç§»
- âœ… **å›¾åƒç¼–è¾‘** - å®Œæ•´çš„å›¾åƒåŠ è½½ã€å˜æ¢ã€é®ç½©åŠŸèƒ½
- âœ… **OBBé€‰æ‹©æ¡†** - åŸºäºæœ‰å‘åŒ…å›´ç›’çš„ç²¾ç¡®é€‰æ‹©ï¼Œæ”¯æŒç¼©æ”¾ã€ç§»åŠ¨ã€æ—‹è½¬
- âœ… **å†å²è®°å½•** - å®Œæ•´çš„æ’¤é”€é‡åšç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨çŠ¶æ€æ•è·
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
- âœ… **æ’ä»¶ç³»ç»Ÿ** - å®Œæ•´çš„æ’ä»¶æ¶æ„ï¼Œæ”¯æŒç±»å‹å®‰å…¨çš„é’©å­æœºåˆ¶
- âœ… **äº‹ä»¶ç³»ç»Ÿ** - å®Œå–„çš„äº‹ä»¶å‘å°„å™¨ï¼Œæ”¯æŒç±»å‹å®‰å…¨çš„è‡ªå®šä¹‰äº‹ä»¶
- âœ… **å¯¹è±¡ç®¡ç†** - æ”¯æŒå›¾å±‚ç®¡ç†ã€z-indexæ’åºã€æ‰¹é‡æ“ä½œ

### äº¤äº’åŠŸèƒ½
- ğŸ–±ï¸ **é¼ æ ‡æ“ä½œ** - å®Œæ•´çš„é¼ æ ‡äº‹ä»¶å¤„ç†
- âŒ¨ï¸ **é”®ç›˜å¿«æ·é”®** - åˆ é™¤ã€æ’¤é”€ã€é‡åšç­‰å¿«æ·é”®
- ğŸ¯ **ç²¾ç¡®é€‰æ‹©** - åŸºäºæ•°å­¦è®¡ç®—çš„ç²¾ç¡®hit-test
- ğŸ”„ **å®æ—¶é¢„è§ˆ** - é«˜æ€§èƒ½çš„å®æ—¶æ¸²æŸ“ç³»ç»Ÿ
- ğŸ¨ **æ™ºèƒ½é€‰æ‹©** - é¢œè‰²é€‰æ‹©å·¥å…·ï¼Œæ”¯æŒå®¹å·®è°ƒæ•´å’Œé¢„è§ˆ
- ğŸ–Œï¸ **é®ç½©ç¼–è¾‘** - ç¬”åˆ·å·¥å…·æ”¯æŒæ·»åŠ /åˆ é™¤é®ç½©åŒºåŸŸ

### å†…ç½®æ’ä»¶
- ğŸ¨ **é¢œè‰²é€‰æ‹©æ’ä»¶** - æ™ºèƒ½é¢œè‰²é€‰æ‹©å·¥å…·ï¼Œæ”¯æŒé­”æ£’ã€å®¹å·®è°ƒæ•´ã€å®æ—¶é¢„è§ˆ
- ğŸ–Œï¸ **é®ç½©ç¬”åˆ·æ’ä»¶** - é®ç½©ç¼–è¾‘å·¥å…·ï¼Œæ”¯æŒç¬”åˆ·å¤§å°è°ƒæ•´ã€æ·»åŠ /åˆ é™¤æ¨¡å¼
- ğŸ“ **ç½‘æ ¼æ’ä»¶** - å¯é…ç½®çš„ç½‘æ ¼èƒŒæ™¯ï¼Œæ”¯æŒæ™®é€šç½‘æ ¼å’Œæ£‹ç›˜æ ¼æ¨¡å¼
- ğŸ“œ **å†å²ç®¡ç†** - æ’¤é”€é‡åšåŠŸèƒ½ï¼Œæ”¯æŒå†å²è®°å½•ç®¡ç†å’ŒçŠ¶æ€æ¢å¤

### é«˜çº§ç‰¹æ€§
- ğŸ¯ **Web Workerä¼˜åŒ–** - é¢œè‰²é€‰æ‹©ä½¿ç”¨Workeræå‡æ€§èƒ½
- ğŸ­ **é®ç½©ç³»ç»Ÿ** - å®Œæ•´çš„å›¾åƒé®ç½©åŠŸèƒ½ï¼Œæ”¯æŒé€æ˜åº¦è°ƒæ•´
- ğŸ“± **é«˜DPIæ”¯æŒ** - å®Œç¾æ”¯æŒé«˜åˆ†è¾¨ç‡å±å¹•
- âš¡ **æ€§èƒ½ä¼˜åŒ–** - æ™ºèƒ½æ¸²æŸ“ã€æ‰¹é‡çŠ¶æ€æ›´æ–°ã€å†…å­˜ç®¡ç†

## ğŸ—ï¸ æ¡†æ¶æ¶æ„

### æ ¸å¿ƒæ¨¡å—

```
src/editor/
â”œâ”€â”€ types.ts                    # ç±»å‹å®šä¹‰
â”œâ”€â”€ index.ts                    # å…¥å£æ–‡ä»¶
â”œâ”€â”€ Editor.ts                   # ä¸»ç¼–è¾‘å™¨ç±»
â”œâ”€â”€ core/                       # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ EventEmitter.ts         # äº‹ä»¶å‘å°„å™¨
â”‚   â”œâ”€â”€ HookManager.ts          # é’©å­ç®¡ç†å™¨
â”‚   â”œâ”€â”€ PluginManager.ts        # æ’ä»¶ç®¡ç†å™¨
â”‚   â”œâ”€â”€ Viewport.ts             # è§†å£ç®¡ç†å™¨ï¼ˆç¼©æ”¾ã€å¹³ç§»ï¼‰
â”‚   â”œâ”€â”€ ObjectManager.ts        # å¯¹è±¡ç®¡ç†å™¨ï¼ˆå›¾å±‚ã€é€‰æ‹©ï¼‰
â”‚   â””â”€â”€ HistoryManager.ts       # å†å²è®°å½•ç®¡ç†å™¨
â”œâ”€â”€ objects/                    # æ¸²æŸ“å¯¹è±¡
â”‚   â”œâ”€â”€ BaseObject.ts           # åŸºç¡€å¯¹è±¡ç±»
â”‚   â””â”€â”€ ImageObject.ts          # å›¾åƒå¯¹è±¡ç±»ï¼ˆæ”¯æŒé®ç½©ï¼‰
â”œâ”€â”€ controls/                   # æ§åˆ¶å™¨
â”‚   â””â”€â”€ SelectionBox.ts         # OBBé€‰æ‹©æ¡†æ§åˆ¶å™¨
â”œâ”€â”€ utils/                      # å·¥å…·ç±»
â”‚   â””â”€â”€ math.ts                 # æ•°å­¦å·¥å…·å‡½æ•°
â””â”€â”€ plugins/                    # å†…ç½®æ’ä»¶
    â”œâ”€â”€ ColorSelectionPlugin.ts # é¢œè‰²é€‰æ‹©æ’ä»¶
    â”œâ”€â”€ MaskBrushPlugin.ts      # é®ç½©ç¬”åˆ·æ’ä»¶
    â”œâ”€â”€ GridPlugin.ts           # ç½‘æ ¼æ’ä»¶
    â””â”€â”€ workers/                # Web Workers
        â””â”€â”€ colorSelectionWorker.ts  # é¢œè‰²é€‰æ‹©ä¼˜åŒ–
```

### è®¾è®¡æ¨¡å¼

1. **äº‹ä»¶é©±åŠ¨æ¶æ„** - æ‰€æœ‰æ¨¡å—é€šè¿‡ç±»å‹å®‰å…¨çš„äº‹ä»¶ç³»ç»Ÿè¿›è¡Œé€šä¿¡
2. **æ’ä»¶åŒ–è®¾è®¡** - åŠŸèƒ½å¯é€šè¿‡æ’ä»¶æ‰©å±•ï¼Œæ”¯æŒæ³›å‹ç±»å‹çº¦æŸ
3. **é’©å­æœºåˆ¶** - å…è®¸åœ¨å…³é”®èŠ‚ç‚¹æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œæ”¯æŒç±»å‹å®‰å…¨çš„å‚æ•°
4. **é¢å‘å¯¹è±¡** - æ¸…æ™°çš„ç±»ç»§æ‰¿å…³ç³»
5. **ç»„åˆæ¨¡å¼** - æ¨¡å—é—´æ¾è€¦åˆï¼Œé«˜å†…èš
6. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿï¼Œäº‹ä»¶å’Œé’©å­éƒ½æœ‰ä¸¥æ ¼çš„ç±»å‹çº¦æŸ

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```typescript
import { createEditor } from './editor';
import { GridPlugin, ColorSelectionPlugin, MaskBrushPlugin } from './editor/plugins';

// åˆ›å»ºç¼–è¾‘å™¨å®ä¾‹
const editor = createEditor({
  container: '#editor-container',
  width: 800,
  height: 600,
  backgroundColor: '#F5F5F5',
  enableSpacePan: true,  // å¯ç”¨ç©ºæ ¼é”®å¹³ç§»
  enableHistory: true,   // å¯ç”¨å†å²è®°å½•
  plugins: [
    new GridPlugin({ 
      size: 20, 
      color: '#E0E0E0',
      checkerboard: false  // å¯é€‰ï¼šæ£‹ç›˜æ ¼æ¨¡å¼
    }),
    new ColorSelectionPlugin({
      tolerance: 32,
      selectionColor: '#FF0000',
      selectionOpacity: 0.5
    }),
    new MaskBrushPlugin({
      brushSize: 20,
      mode: 'add',
      opacity: 0.5
    })
  ]
});

// æ·»åŠ å›¾åƒ
editor.addImage({
  src: 'path/to/image.jpg',
  x: 100,  // å¯é€‰ï¼šæŒ‡å®šä½ç½®
  y: 100
}).then(imageObject => {
  console.log('å›¾åƒæ·»åŠ æˆåŠŸ:', imageObject);
  
  // é€‰æ‹©å›¾åƒ
  editor.selectObject(imageObject);
});

// æ‰¹é‡å¯¼å…¥å›¾åƒæ•°æ®
const imageData = [
  { src: 'image1.jpg', x: 0, y: 0, type: 'image' },
  { src: 'image2.jpg', x: 200, y: 100, type: 'image' }
];
editor.importByJson(imageData);
```

### äº‹ä»¶ç›‘å¬

```typescript
import { EditorEvents } from './editor/types';

// ç›‘å¬é€‰æ‹©å˜åŒ–
editor.on(EditorEvents.SELECTION_CHANGED, (data) => {
  console.log('é€‰æ‹©çš„å¯¹è±¡:', data.newTarget);
});

// ç›‘å¬å¯¹è±¡å˜åŒ–
editor.on(EditorEvents.OBJECT_MOVED, (data) => {
  console.log('å¯¹è±¡ç§»åŠ¨:', data.object);
});

// ç›‘å¬è§†å£å˜åŒ–
editor.on(EditorEvents.VIEWPORT_ZOOM, (data) => {
  console.log('ç¼©æ”¾çº§åˆ«:', data.zoom);
});

// ç›‘å¬å†å²è®°å½•å˜åŒ–
editor.on(EditorEvents.HISTORY_UNDO, (data) => {
  console.log('æ’¤é”€æ“ä½œ:', data.state);
});

// ç›‘å¬ç©ºæ ¼é”®å¹³ç§»
editor.on(EditorEvents.PAN_START, (data) => {
  console.log('å¼€å§‹å¹³ç§»:', data.point);
});

// ç›‘å¬ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ
editor.on(EditorEvents.EDITOR_INITIALIZED, (data) => {
  console.log('ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ:', data.editor);
});
```

### æ’ä»¶åŠŸèƒ½ä½¿ç”¨

```typescript
// ä½¿ç”¨é¢œè‰²é€‰æ‹©åŠŸèƒ½
const colorPlugin = editor.plugins.getPlugin('colorSelection');
if (colorPlugin) {
  // è®¾ç½®å®¹å·®
  colorPlugin.setTolerance(50);
  
  // è®¾ç½®é€‰æ‹©é¢œè‰²
  colorPlugin.setSelectionColor('#00FF00');
  
  // è·å–é€‰æ‹©é®ç½©
  const mask = colorPlugin.getSelectionMask();
  
  // æ¸…é™¤å½“å‰é€‰æ‹©
  colorPlugin.clearSelection();
}

// ä½¿ç”¨é®ç½©ç¬”åˆ·åŠŸèƒ½
const brushPlugin = editor.plugins.getPlugin('maskBrush');
if (brushPlugin) {
  // è®¾ç½®ç¬”åˆ·å¤§å°
  brushPlugin.setBrushSize(30);
  
  // åˆ‡æ¢æ¨¡å¼ï¼ˆæ·»åŠ /åˆ é™¤ï¼‰
  brushPlugin.setMode('remove');
  
  // æ¸…é™¤é®ç½©
  brushPlugin.clearMask();
}

// ç½‘æ ¼æ§åˆ¶
const gridPlugin = editor.plugins.getPlugin('grid');
if (gridPlugin) {
  // æ˜¾ç¤º/éšè—ç½‘æ ¼
  gridPlugin.show();
  gridPlugin.hide();
  
  // å¯ç”¨æ£‹ç›˜æ ¼æ¨¡å¼
  gridPlugin.enableCheckerboard();
  gridPlugin.setCheckerboardColors('#FFFFFF', '#F0F0F0');
}
```

### æ’ä»¶å¼€å‘

#### ç®€å•æ’ä»¶ç¤ºä¾‹

```typescript
import { Plugin, Editor } from './editor';
import type { Point } from './editor/types';
import { EditorHooks } from './editor/types';

class WatermarkPlugin implements Plugin<Editor> {
  name = 'watermark';
  version = '1.0.0';
  
  private editor!: Editor;
  private text: string = 'Watermark';
  private enabled: boolean = true;
  
  install(editor: Editor): void {
    this.editor = editor;
    
    // æ³¨å†Œæ¸²æŸ“é’©å­
    editor.hooks.after(EditorHooks.RENDER_AFTER, this.renderWatermark.bind(this));
  }
  
  uninstall(editor: Editor): void {
    // ç§»é™¤é’©å­
    editor.hooks.removeHook(EditorHooks.RENDER_AFTER, this.renderWatermark, 'after');
  }
  
  private renderWatermark(ctx: CanvasRenderingContext2D): void {
    if (!this.enabled) return;
    
    ctx.save();
    ctx.globalAlpha = 0.3;
    ctx.fillStyle = '#999999';
    ctx.font = '16px Arial';
    ctx.textAlign = 'center';
    
    const centerX = this.editor.viewport.width / 2;
    const centerY = this.editor.viewport.height / 2;
    
    // è½¬æ¢åˆ°ä¸–ç•Œåæ ‡
    const worldCenter = this.editor.viewport.screenToWorld({ x: centerX, y: centerY });
    ctx.fillText(this.text, worldCenter.x, worldCenter.y);
    
    ctx.restore();
  }
  
  // å…¬å…±API
  public setText(text: string): void {
    this.text = text;
    this.editor.requestRender();
  }
  
  public enable(): void {
    this.enabled = true;
    this.editor.requestRender();
  }
  
  public disable(): void {
    this.enabled = false;
    this.editor.requestRender();
  }
}
```

#### å¤æ‚äº¤äº’æ’ä»¶ç¤ºä¾‹

```typescript
import { EditorHooks } from './editor/types';

class DrawingPlugin implements Plugin<Editor> {
  name = 'drawing';
  version = '1.0.0';
  
  private editor!: Editor;
  private isDrawing: boolean = false;
  private currentPath: Point[] = [];
  private paths: Point[][] = [];
  private strokeColor: string = '#000000';
  private lineWidth: number = 2;
  
  install(editor: Editor): void {
    this.editor = editor;
    
    // æ³¨å†Œäº‹ä»¶é’©å­
    editor.hooks.before(EditorHooks.MOUSE_DOWN, this.onMouseDown.bind(this));
    editor.hooks.before(EditorHooks.MOUSE_MOVE, this.onMouseMove.bind(this));
    editor.hooks.before(EditorHooks.MOUSE_UP, this.onMouseUp.bind(this));
    
    // æ³¨å†Œæ¸²æŸ“é’©å­
    editor.hooks.after(EditorHooks.RENDER_AFTER, this.renderPaths.bind(this));
    
    // æ·»åŠ å·¥å…·åˆ‡æ¢åŠŸèƒ½
    (editor as any).setDrawingMode = (enabled: boolean) => {
      this.setEnabled(enabled);
    };
  }
  
  uninstall(editor: Editor): void {
    // æ¸…ç†é’©å­
    editor.hooks.removeHook(EditorHooks.MOUSE_DOWN, this.onMouseDown);
    editor.hooks.removeHook(EditorHooks.MOUSE_MOVE, this.onMouseMove);
    editor.hooks.removeHook(EditorHooks.MOUSE_UP, this.onMouseUp);
    editor.hooks.removeHook(EditorHooks.RENDER_AFTER, this.renderPaths, 'after');
    
    // æ¸…ç†æ‰©å±•æ–¹æ³•
    delete (editor as any).setDrawingMode;
  }
  
  private onMouseDown = (worldPoint: Point, event: MouseEvent): boolean => {
    if (this.editor.getTool() !== 'drawing') return true;
    
    this.isDrawing = true;
    this.currentPath = [worldPoint];
    
    // è¿”å›falseé˜»æ­¢é»˜è®¤è¡Œä¸º
    return false;
  };
  
  private onMouseMove = (worldPoint: Point, event: MouseEvent): boolean => {
    if (!this.isDrawing || this.editor.getTool() !== 'drawing') return true;
    
    this.currentPath.push(worldPoint);
    this.editor.requestRender();
    
    return false;
  };
  
  private onMouseUp = (worldPoint: Point, event: MouseEvent): boolean => {
    if (!this.isDrawing) return true;
    
    this.isDrawing = false;
    if (this.currentPath.length > 1) {
      this.paths.push([...this.currentPath]);
      // è§¦å‘å†å²è®°å½•
      this.editor.hooks.trigger(EditorHooks.HISTORY_CAPTURE, 'Drawing path');
    }
    this.currentPath = [];
    
    return false;
  };
  
  private renderPaths(ctx: CanvasRenderingContext2D): void {
    if (this.editor.getTool() !== 'drawing') return;
    
    ctx.save();
    ctx.strokeStyle = this.strokeColor;
    ctx.lineWidth = this.lineWidth / this.editor.viewport.zoom; // ä¿æŒçº¿å®½ä¸å˜
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    
    // ç»˜åˆ¶å·²å®Œæˆçš„è·¯å¾„
    this.paths.forEach(path => {
      this.drawPath(ctx, path);
    });
    
    // ç»˜åˆ¶å½“å‰è·¯å¾„
    if (this.currentPath.length > 1) {
      this.drawPath(ctx, this.currentPath);
    }
    
    ctx.restore();
  }
  
  private drawPath(ctx: CanvasRenderingContext2D, path: Point[]): void {
    if (path.length < 2) return;
    
    ctx.beginPath();
    ctx.moveTo(path[0].x, path[0].y);
    
    for (let i = 1; i < path.length; i++) {
      ctx.lineTo(path[i].x, path[i].y);
    }
    
    ctx.stroke();
  }
  
  // å…¬å…±API
  public setStrokeColor(color: string): void {
    this.strokeColor = color;
  }
  
  public setLineWidth(width: number): void {
    this.lineWidth = width;
  }
  
  public clearPaths(): void {
    this.paths = [];
    this.editor.requestRender();
    this.editor.hooks.trigger(EditorHooks.HISTORY_CAPTURE, 'Clear drawing');
  }
  
  private setEnabled(enabled: boolean): void {
    if (enabled) {
      this.editor.setTool('drawing');
    } else {
      this.editor.setTool('select');
    }
  }
}

// ä½¿ç”¨æ’ä»¶
const watermarkPlugin = new WatermarkPlugin();
const drawingPlugin = new DrawingPlugin();

editor.plugins.use(watermarkPlugin);
editor.plugins.use(drawingPlugin);

// é…ç½®æ’ä»¶
watermarkPlugin.setText('Â© 2024 My Company');
drawingPlugin.setStrokeColor('#FF0000');
drawingPlugin.setLineWidth(3);
```

### é’©å­ç³»ç»Ÿ

```typescript
import { EditorHooks } from './editor/types';

// æ³¨å†Œå‰ç½®é’©å­ï¼ˆå¯é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼‰
editor.hooks.before(EditorHooks.MOUSE_DOWN, (worldPoint, event) => {
  console.log('é¼ æ ‡æŒ‰ä¸‹å‰å¤„ç†:', worldPoint);
  // è¿”å› false å¯ä»¥é˜»æ­¢åç»­æ‰§è¡Œ
  if (someCondition) {
    return false;
  }
});

// æ³¨å†Œåç½®é’©å­
editor.hooks.after(EditorHooks.OBJECT_DRAG_END, (event) => {
  console.log('æ‹–æ‹½ç»“æŸåå¤„ç†');
  // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘å†å²è®°å½•
  editor.hooks.trigger(EditorHooks.HISTORY_CAPTURE, 'Object moved');
});

// æ¸²æŸ“ç›¸å…³é’©å­
editor.hooks.before(EditorHooks.RENDER_BEFORE, (ctx) => {
  // åœ¨ä¸»æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼ˆå¦‚ç»˜åˆ¶èƒŒæ™¯ï¼‰
  console.log('å¼€å§‹æ¸²æŸ“å‰çš„å‡†å¤‡');
});

editor.hooks.after(EditorHooks.RENDER_AFTER, (ctx) => {
  // åœ¨ä¸»æ¸²æŸ“ä¹‹åæ‰§è¡Œï¼ˆå¦‚ç»˜åˆ¶è¦†ç›–å±‚ï¼‰
  console.log('æ¸²æŸ“å®Œæˆåçš„å¤„ç†');
});

// å†å²è®°å½•é’©å­
editor.hooks.after(EditorHooks.HISTORY_CAPTURE, (description) => {
  console.log('æ•è·å†å²çŠ¶æ€:', description);
});

// å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé’©å­
editor.hooks.before(EditorHooks.OBJECT_BEFORE_ADD, (object) => {
  console.log('å¯¹è±¡æ·»åŠ å‰:', object);
});

editor.hooks.after(EditorHooks.OBJECT_AFTER_ADD, (object) => {
  console.log('å¯¹è±¡æ·»åŠ å:', object);
});

// é’©å­è§¦å‘ç¤ºä¾‹
editor.hooks.trigger(EditorHooks.HISTORY_CAPTURE, 'Custom operation');
```

## ğŸ® æ“ä½œè¯´æ˜

### é¼ æ ‡æ“ä½œ
- **ç¼©æ”¾**: é¼ æ ‡æ»šè½®ç¼©æ”¾ç”»å¸ƒï¼Œä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒ
- **å¹³ç§»**: æŒ‰ä½ Shift + å·¦é”®æ‹–æ‹½ æˆ– ä¸­é”®æ‹–æ‹½
- **ç©ºæ ¼å¹³ç§»**: æŒ‰ä½ç©ºæ ¼é”® + å·¦é”®æ‹–æ‹½ç”»å¸ƒ
- **é€‰æ‹©**: ç‚¹å‡»å›¾åƒè¿›è¡Œé€‰æ‹©
- **ç§»åŠ¨**: æ‹–æ‹½é€‰ä¸­çš„å›¾åƒ
- **ç¼©æ”¾å¯¹è±¡**: æ‹–æ‹½é€‰æ‹©æ¡†çš„è§’ç‚¹æ§åˆ¶ç‚¹ï¼ˆç­‰æ¯”ç¼©æ”¾ï¼‰
- **æ‹‰ä¼¸å¯¹è±¡**: æ‹–æ‹½é€‰æ‹©æ¡†çš„è¾¹ç¼˜ä¸­ç‚¹æ§åˆ¶ç‚¹ï¼ˆå•å‘æ‹‰ä¼¸ï¼‰
- **æ—‹è½¬**: æ‹–æ‹½æ—‹è½¬æ§åˆ¶ç‚¹ï¼ˆåœ†å½¢å›¾æ ‡ï¼‰

### é¢œè‰²é€‰æ‹©å·¥å…·
- **æ¿€æ´»**: é€‰æ‹©é¢œè‰²é€‰æ‹©æ’ä»¶åï¼Œç‚¹å‡»å›¾åƒå¼€å§‹é€‰æ‹©
- **åœ†å½¢é€‰æ‹©**: æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–æ‹½åˆ›å»ºåœ†å½¢é€‰æ‹©åŒºåŸŸ
- **å®æ—¶é¢„è§ˆ**: æ‹–æ‹½è¿‡ç¨‹ä¸­å¯å®æ—¶é¢„è§ˆé€‰æ‹©æ•ˆæœ
- **å®¹å·®è°ƒæ•´**: é€šè¿‡æ’ä»¶APIè°ƒæ•´é¢œè‰²å®¹å·®å€¼

### é®ç½©ç¬”åˆ·å·¥å…·
- **ç¬”åˆ·ç»˜åˆ¶**: åœ¨å›¾åƒä¸ŠæŒ‰ä½å·¦é”®æ‹–æ‹½è¿›è¡Œæ¶‚æŠ¹
- **æ·»åŠ æ¨¡å¼**: æ¶‚æŠ¹æ·»åŠ é®ç½©åŒºåŸŸ
- **åˆ é™¤æ¨¡å¼**: æ¶‚æŠ¹ç§»é™¤é®ç½©åŒºåŸŸ
- **ç¬”åˆ·å¤§å°**: é€šè¿‡APIåŠ¨æ€è°ƒæ•´ç¬”åˆ·å¤§å°

### é”®ç›˜å¿«æ·é”®
- **Delete/Backspace**: åˆ é™¤é€‰ä¸­å¯¹è±¡
- **Ctrl+Z**: æ’¤é”€æ“ä½œ
- **Ctrl+Shift+Z / Ctrl+Y**: é‡åšæ“ä½œ
- **Ctrl+A**: å…¨é€‰ï¼ˆé€‰æ‹©ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼‰
- **Ctrl+C**: å¤åˆ¶é€‰ä¸­å¯¹è±¡
- **Ctrl+V**: ç²˜è´´å¯¹è±¡
- **Escape**: å–æ¶ˆé€‰æ‹©
- **Space**: æŒ‰ä½ç©ºæ ¼é”®å¯ç”¨å¹³ç§»æ¨¡å¼

## ğŸ”§ API æ–‡æ¡£

### Editor ç±»

#### æ„é€ å‡½æ•°
```typescript
new Editor(options: EditorOptions)
```

#### ä¸»è¦æ–¹æ³•

**å¯¹è±¡ç®¡ç†**
- `addObject(object: BaseObject, layerId?: string, needRecord?: boolean)` - æ·»åŠ å¯¹è±¡
- `removeObject(object: BaseObject)` - ç§»é™¤å¯¹è±¡
- `selectObject(object: BaseObject)` - é€‰æ‹©å¯¹è±¡
- `clearSelection()` - æ¸…é™¤é€‰æ‹©
- `getSelectedObject(): BaseObject | null` - è·å–é€‰ä¸­å¯¹è±¡
- `selectAll()` - é€‰æ‹©æ‰€æœ‰å¯¹è±¡
- `deleteSelected()` - åˆ é™¤é€‰ä¸­å¯¹è±¡

**å›¾åƒæ“ä½œ**
- `addImage({ src, x?, y?, needRecord? })` - æ·»åŠ å›¾åƒï¼Œè¿”å›Promise
- `importByJson(data: Array)` - æ‰¹é‡å¯¼å…¥å›¾åƒæ•°æ®
- `toDataURL(type?: string, quality?: number)` - å¯¼å‡ºå›¾åƒ

**è§†å£æ§åˆ¶**
- `zoomIn() / zoomOut()` - ç¼©æ”¾æ“ä½œ
- `zoomToFit()` - é€‚åº”ç”»å¸ƒ
- `resetZoom()` - é‡ç½®ç¼©æ”¾
- `enableSpacePan() / disableSpacePan()` - å¯ç”¨/ç¦ç”¨ç©ºæ ¼å¹³ç§»
- `isSpacePanEnabled(): boolean` - æ£€æŸ¥ç©ºæ ¼å¹³ç§»çŠ¶æ€

**å†å²è®°å½•**
- `undo() / redo()` - æ’¤é”€/é‡åš
- `enableHistory() / disableHistory()` - å¯ç”¨/ç¦ç”¨å†å²è®°å½•
- `isHistoryEnabled(): boolean` - æ£€æŸ¥å†å²è®°å½•çŠ¶æ€

**çŠ¶æ€ç®¡ç†**
- `getState(): any` - è·å–ç¼–è¾‘å™¨çŠ¶æ€
- `setState(state: any)` - è®¾ç½®ç¼–è¾‘å™¨çŠ¶æ€
- `suspendRendering() / resumeRendering()` - æš‚åœ/æ¢å¤æ¸²æŸ“

**å·¥å…·åˆ‡æ¢**
- `setTool(tool: string)` - è®¾ç½®å½“å‰å·¥å…·
- `getCurrentTool(): string` - è·å–å½“å‰å·¥å…·

**å…¶ä»–**
- `getCanvas(): HTMLCanvasElement` - è·å–ç”»å¸ƒå…ƒç´ 
- `getContext(): CanvasRenderingContext2D` - è·å–ç”»å¸ƒä¸Šä¸‹æ–‡
- `isReady(): boolean` - æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–
- `destroy()` - é”€æ¯ç¼–è¾‘å™¨

### BaseObject ç±»

#### ä¸»è¦å±æ€§
- `id: string` - å”¯ä¸€æ ‡è¯†
- `type: string` - å¯¹è±¡ç±»å‹
- `transform: Transform` - å˜æ¢ä¿¡æ¯ï¼ˆä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰
- `visible: boolean` - æ˜¯å¦å¯è§
- `selectable: boolean` - æ˜¯å¦å¯é€‰æ‹©
- `width: number` - å¯¹è±¡å®½åº¦
- `height: number` - å¯¹è±¡é«˜åº¦
- `fill: string` - å¡«å……é¢œè‰²
- `stroke: string` - æè¾¹é¢œè‰²
- `strokeWidth: number` - æè¾¹å®½åº¦
- `opacity: number` - é€æ˜åº¦

#### ä¸»è¦æ–¹æ³•

**å˜æ¢æ“ä½œ**
- `move(deltaX: number, deltaY: number)` - ç›¸å¯¹ç§»åŠ¨
- `setPosition(x: number, y: number)` - è®¾ç½®ç»å¯¹ä½ç½®
- `scale(scaleX: number, scaleY?: number)` - ç›¸å¯¹ç¼©æ”¾
- `setScale(scaleX: number, scaleY?: number)` - è®¾ç½®ç»å¯¹ç¼©æ”¾
- `rotate(angle: number)` - ç›¸å¯¹æ—‹è½¬
- `setRotation(angle: number)` - è®¾ç½®ç»å¯¹æ—‹è½¬
- `setSize(width: number, height: number)` - è®¾ç½®å°ºå¯¸

**å‡ ä½•è®¡ç®—**
- `hitTest(point: Point): boolean` - ç¢°æ’æ£€æµ‹
- `getBounds(): Bounds` - è·å–åŒ…å›´ç›’
- `getOBB(): OBB` - è·å–æœ‰å‘åŒ…å›´ç›’
- `getCenter(): Point` - è·å–ä¸­å¿ƒç‚¹
- `setCenter(point: Point)` - è®¾ç½®ä¸­å¿ƒç‚¹
- `intersectsWith(other: BaseObject): boolean` - æ£€æµ‹ä¸å…¶ä»–å¯¹è±¡ç›¸äº¤

**å…¶ä»–**
- `render(ctx: CanvasRenderingContext2D)` - æ¸²æŸ“æ–¹æ³•ï¼ˆæŠ½è±¡ï¼‰
- `clone(): BaseObject` - å…‹éš†å¯¹è±¡
- `toJSON(): any` - åºåˆ—åŒ–ä¸ºJSON
- `destroy()` - é”€æ¯å¯¹è±¡ï¼ˆæŠ½è±¡ï¼‰

### ImageObject ç±»

ç»§æ‰¿è‡ª BaseObjectï¼Œä¸“é—¨ç”¨äºå¤„ç†å›¾åƒã€‚

#### ç‰¹æœ‰å±æ€§
- `src: string` - å›¾åƒæºè·¯å¾„
- `crossOrigin: string | null` - è·¨åŸŸè®¾ç½®
- `filters: string[]` - CSSæ»¤é•œæ•ˆæœ
- `hasMask: boolean` - æ˜¯å¦æœ‰é®ç½©
- `maskOpacity: number` - é®ç½©é€æ˜åº¦
- `maskColor: string` - é®ç½©é¢œè‰²

#### ç‰¹æœ‰æ–¹æ³•

**å›¾åƒæ§åˆ¶**
- `setSrc(src: string)` - è®¾ç½®å›¾åƒæº
- `getSrc(): string` - è·å–å›¾åƒæº
- `isLoaded(): boolean` - æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
- `getImage(): HTMLImageElement` - è·å–HTMLå›¾åƒå…ƒç´ 

**æ»¤é•œç®¡ç†**
- `addFilter(filter: string)` - æ·»åŠ æ»¤é•œ
- `removeFilter(filter: string)` - ç§»é™¤æ»¤é•œ
- `clearFilters()` - æ¸…é™¤æ‰€æœ‰æ»¤é•œ
- `setFilters(filters: string[])` - è®¾ç½®æ»¤é•œåˆ—è¡¨

**é®ç½©æ“ä½œ**
- `setMaskOpacity(opacity: number)` - è®¾ç½®é®ç½©é€æ˜åº¦
- `setMaskColor(color: string)` - è®¾ç½®é®ç½©é¢œè‰²
- `getMaskData(): ImageData | null` - è·å–é®ç½©æ•°æ®
- `setMaskData(imageData: ImageData)` - è®¾ç½®é®ç½©æ•°æ®
- `clearMask()` - æ¸…é™¤é®ç½©
- `hasMaskData(): boolean` - æ£€æŸ¥æ˜¯å¦æœ‰é®ç½©æ•°æ®

**å›¾åƒå¤„ç†**
- `getImageData(ctx?: CanvasRenderingContext2D): ImageData | null` - è·å–å›¾åƒæ•°æ®
- `setImageData(imageData: ImageData)` - è®¾ç½®å›¾åƒæ•°æ®
- `crop(x: number, y: number, width: number, height: number)` - è£å‰ªå›¾åƒ

### æ’ä»¶æ¥å£

```typescript
interface Plugin<T = any> {
  name: string;
  version: string;
  install: (editor: T) => void;
  uninstall?: (editor: T) => void;
}

// å…·ä½“ä½¿ç”¨æ—¶æŒ‡å®šEditorç±»å‹
class MyPlugin implements Plugin<Editor> {
  install(editor: Editor): void {
    // editorå‚æ•°å…·æœ‰å®Œæ•´çš„ç±»å‹æç¤º
  }
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd image-editor
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

4. **è®¿é—®æ¼”ç¤º**
æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5173`

## ğŸŒŸ ç¤ºä¾‹åŠŸèƒ½

å½“å‰æ¼”ç¤ºåº”ç”¨åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š

### åŸºç¡€åŠŸèƒ½
- âœ¨ å®Œæ•´çš„å·¥å…·æ ç•Œé¢
- ğŸ–¼ï¸ å›¾åƒä¸Šä¼ å’Œæ·»åŠ ï¼Œæ”¯æŒæ‰¹é‡å¯¼å…¥
- ğŸ¯ ç²¾ç¡®çš„å¯¹è±¡é€‰æ‹©å’Œæ“ä½œï¼ˆOBBé€‰æ‹©æ¡†ï¼‰
- ğŸ“ ç½‘æ ¼èƒŒæ™¯æ˜¾ç¤ºï¼ˆæ™®é€šç½‘æ ¼/æ£‹ç›˜æ ¼æ¨¡å¼ï¼‰
- ğŸ“œ å®Œæ•´çš„æ’¤é”€é‡åšåŠŸèƒ½ï¼Œæ”¯æŒè‡ªåŠ¨çŠ¶æ€æ•è·
- ğŸ” ç¼©æ”¾å’Œå¹³ç§»æ“ä½œï¼Œæ”¯æŒç©ºæ ¼é”®å¹³ç§»
- ğŸ’¾ å›¾åƒå¯¼å‡ºåŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ ¼å¼

### é«˜çº§åŠŸèƒ½
- ğŸ¨ **æ™ºèƒ½é¢œè‰²é€‰æ‹©** - é­”æ£’å·¥å…·ï¼Œæ”¯æŒå®¹å·®è°ƒæ•´å’Œå®æ—¶é¢„è§ˆ
- ğŸ–Œï¸ **é®ç½©ç¬”åˆ·å·¥å…·** - æ”¯æŒæ·»åŠ /åˆ é™¤é®ç½©ï¼Œç¬”åˆ·å¤§å°è°ƒæ•´
- âš¡ **Web Workerä¼˜åŒ–** - é¢œè‰²é€‰æ‹©ä½¿ç”¨Workeræå‡æ€§èƒ½
- ğŸ­ **å›¾åƒé®ç½©ç³»ç»Ÿ** - å®Œæ•´çš„é®ç½©åŠŸèƒ½ï¼Œæ”¯æŒé€æ˜åº¦è°ƒæ•´
- ğŸ“± **é«˜DPIæ”¯æŒ** - å®Œç¾æ”¯æŒRetinaç­‰é«˜åˆ†è¾¨ç‡å±å¹•
- ğŸ® **ç©ºæ ¼é”®å¹³ç§»** - ç±»ä¼¼PhotoShopçš„ç©ºæ ¼é”®æŠ“æ‰‹å·¥å…·

### å¼€å‘è€…åŠŸèƒ½
- ğŸ”§ **æ’ä»¶ç³»ç»Ÿ** - å®Œæ•´çš„æ’ä»¶æ¶æ„ï¼Œæ”¯æŒç±»å‹å®‰å…¨çš„è‡ªå®šä¹‰åŠŸèƒ½æ‰©å±•
- ğŸ¯ **é’©å­æœºåˆ¶** - ä¸°å¯Œçš„é’©å­ç‚¹ï¼Œå¯åœ¨å…³é”®æ—¶æœºæ’å…¥ç±»å‹å®‰å…¨çš„è‡ªå®šä¹‰é€»è¾‘
- ğŸ“Š **çŠ¶æ€ç®¡ç†** - å®Œæ•´çš„çŠ¶æ€åºåˆ—åŒ–å’Œæ¢å¤æœºåˆ¶
- ğŸª **äº‹ä»¶ç³»ç»Ÿ** - ä¸°å¯Œçš„äº‹ä»¶ç±»å‹ï¼Œæ”¯æŒç±»å‹å®‰å…¨çš„è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬
- ğŸ“‹ **å†å²è®°å½•** - æ”¯æŒè‡ªå®šä¹‰å†å²æ•è·ç­–ç•¥å’ŒçŠ¶æ€ç®¡ç†
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

## ğŸ”® æ‰©å±•æ€§

æ¡†æ¶è®¾è®¡æ—¶å……åˆ†è€ƒè™‘äº†æ‰©å±•æ€§ï¼š

1. **æ–°å¯¹è±¡ç±»å‹** - ç»§æ‰¿BaseObjectåˆ›å»ºæ–°çš„æ¸²æŸ“å¯¹è±¡ï¼ˆå¦‚æ–‡æœ¬ã€å½¢çŠ¶ç­‰ï¼‰
2. **è‡ªå®šä¹‰å·¥å…·** - é€šè¿‡æ’ä»¶ç³»ç»Ÿæ·»åŠ æ–°å·¥å…·ï¼ˆå¦‚ç»˜å›¾ã€æ ‡æ³¨ç­‰ï¼‰
3. **ç•Œé¢å®šåˆ¶** - äº‹ä»¶ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰UIæ§åˆ¶å’Œäº¤äº’é€»è¾‘
4. **æ¸²æŸ“å¢å¼º** - é’©å­ç³»ç»Ÿå…è®¸è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ï¼ˆå¦‚æ°´å°ã€ç‰¹æ•ˆç­‰ï¼‰
5. **æ•°æ®æ ¼å¼** - æ”¯æŒè‡ªå®šä¹‰åºåˆ—åŒ–æ ¼å¼å’Œå¯¼å…¥å¯¼å‡º
6. **æ€§èƒ½ä¼˜åŒ–** - Web Workeræ”¯æŒï¼Œå¯æ‰©å±•æ›´å¤šè®¡ç®—å¯†é›†å‹åŠŸèƒ½
7. **é®ç½©ç³»ç»Ÿ** - å®Œæ•´çš„é®ç½©APIï¼Œæ”¯æŒå¤æ‚çš„å›¾åƒå¤„ç†éœ€æ±‚
8. **å†å²ç³»ç»Ÿ** - å¯æ‰©å±•çš„å†å²è®°å½•æœºåˆ¶ï¼Œæ”¯æŒè‡ªå®šä¹‰çŠ¶æ€ç®¡ç†ç­–ç•¥

### å…¸å‹æ‰©å±•åœºæ™¯

- **æ–‡æœ¬ç¼–è¾‘å™¨** - æ·»åŠ TextObjectç±»å’Œæ–‡æœ¬ç¼–è¾‘æ’ä»¶
- **çŸ¢é‡ç»˜å›¾** - æ·»åŠ Pathã€Rectangleã€Circleç­‰å½¢çŠ¶å¯¹è±¡
- **å›¾åƒæ»¤é•œ** - é€šè¿‡æ’ä»¶ç³»ç»Ÿæ·»åŠ å„ç§å›¾åƒå¤„ç†æ»¤é•œ
- **åä½œç¼–è¾‘** - é€šè¿‡äº‹ä»¶ç³»ç»Ÿå’ŒçŠ¶æ€ç®¡ç†å®ç°å¤šç”¨æˆ·åä½œ
- **AIåŠŸèƒ½** - é›†æˆAI APIï¼Œå®ç°æ™ºèƒ½æŠ å›¾ã€å†…å®¹è¯†åˆ«ç­‰åŠŸèƒ½

## ğŸ“ æŠ€æœ¯æ ˆ

- **TypeScript** - ç±»å‹å®‰å…¨çš„å¼€å‘ä½“éªŒ
- **Canvas API** - é«˜æ€§èƒ½çš„å›¾å½¢æ¸²æŸ“
- **Vue 3** - ç°ä»£åŒ–çš„UIæ¡†æ¶
- **Vite** - å¿«é€Ÿçš„æ„å»ºå·¥å…·

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªæ¡†æ¶ï¼

## ğŸ“„ è®¸å¯è¯

MIT License